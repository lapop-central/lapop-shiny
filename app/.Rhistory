filter(as_factor(wave) %in% wave_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(ing4) %>%
summarize(n = n())
hist_df
hist_df <- dstrata %>%
filter(as_factor(wave) %in% wave_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(ing4) %>%
summarize(n = n()) %>%
mutate(prop = prop.table(n))
hist_df
hist_df <- gm %>%
filter(as_factor(wave) %in% input$wave) %>%
filter(pais_nam %in% input$pais)
hist_df <- gm %>%
filter(as_factor(wave) %in% wave_sel) %>%
filter(pais_nam %in% pais_sel)
hist_dta <- as.data.frame(prop.table(table(haven::as_factor(zap_missing(hist_df[[ing4]]))))*100)
?lapop_hist
hist_df <- dstrata %>%
filter(as_factor(wave) %in% wave_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(ing4) %>%
summarize(n = n()) %>%
mutate(prop = prop.table(n))
hist_df
hist_df <- dstrata %>%
filter(as_factor(wave) %in% wave_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(ing4) %>%
summarize(n = n()) %>%
drop.na() %>%
mutate(prop = prop.table(n) * 100,
proplabel = paste(round(prop), "%", sep = ""))
hist_df <- dstrata %>%
filter(as_factor(wave) %in% wave_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(ing4) %>%
summarize(n = n()) %>%
drop_na() %>%
mutate(prop = prop.table(n) * 100,
proplabel = paste(round(prop), "%", sep = ""))
hist_df
hist_df <- dstrata %>%
filter(as_factor(wave) %in% wave_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(as_factor(ing4)) %>%
summarize(n = n()) %>%
drop_na() %>%
mutate(prop = prop.table(n) * 100,
proplabel = paste(round(prop), "%", sep = ""))
hist_df
hist_df <- dstrata %>%
filter(as_factor(wave) %in% wave_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(as_factor(zap_missing(ing4))) %>%
summarize(n = n()) %>%
drop_na() %>%
mutate(prop = prop.table(n) * 100,
proplabel = paste(round(prop), "%", sep = ""))
hist_df
hist_df <- dstrata %>%
filter(as_factor(wave) %in% wave_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(as_factor(zap_missing(ing4))) %>%
summarize(n = n()) %>%
# drop_na() %>%
mutate(prop = prop.table(n) * 100,
proplabel = paste(round(prop), "%", sep = ""))
hist_df
hist_df <- dstrata %>%
filter(as_factor(wave) %in% wave_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(as_factor(zap_missing(ing4))) %>%
summarize(n = n()) %>%
drop_na() %>%
mutate(prop = prop.table(n) * 100,
proplabel = paste(round(prop), "%", sep = ""))  %>%
rename(cat = 1)
hist_df
runApp('Documents/GitHub/lapop-shiny/app')
dta_cc = dstrata %>%
filter(as_factor(wave) %in% input$wave) %>%
filter(pais_nam %in% input$pais) %>%
group_by(vallabel = as.character(as_factor(pais_lab))) %>%
summarise_at(vars(outcome()),
list(prop = ~survey_mean(between(., input$recode[1],
input$recode[2]),
na.rm = TRUE,
vartype = "ci") * 100)) %>%
mutate(proplabel = paste0(round(prop), "%")) %>%
rename(.,  lb = prop_low, ub = prop_upp)
dta_cc = dstrata %>%
filter(as_factor(wave) %in% wave_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(vallabel = as.character(as_factor(pais_lab))) %>%
summarise_at(vars(outcome()),
list(prop = ~survey_mean(between(., input$recode[1],
input$recode[2]),
na.rm = TRUE,
vartype = "ci") * 100)) %>%
mutate(proplabel = paste0(round(prop), "%")) %>%
rename(.,  lb = prop_low, ub = prop_upp)
vars <- c(
# "a4",
# "aoj11",
# "aoj12",
# "b1",
# "b12",
# "b13",
# "b18",
"b2",
# "b20",
# "b20a",
# "b21",
# "b21a",
# "b3",
# "b31",
# "b32",
# "b37",
# "b4",
# "b47a",
# "b6",
# "cct1b",
# "clien1n",
# "clien1na",
# "cp13",
# "cp2",
# "cp20",
# "cp6",
# "cp7",
# "cp8",
# "d1",
# "d2",
# "d3",
# "d4",
# "d5",
# "d6",
# "drk1",
# "dst1b",
# "e5",
# "ed",
# "eff1",
# "eff2",
# "env1c",
# "env2b",
# "etid",
# "exc11",
# "exc13",
# "exc14",
# "exc15",
# "exc16",
# "exc18",
"exc2",
# "exc20",
# "exc6",
# "exc7",
# "exc7new",
"fs2",
# "fs8",
# "gi0",
# "gi0n",
# "idio2",
# "infrax",
"ing4",
# "it1",
# "jc10",
# "jc13",
# "jc15a",
# "jc16a",
# "l1",
# "l1b",
# "leng1",
# "lib1",
# "lib2c",
# "m1",
# "mil10a",
# "mil10e",
# "np1",
# "ocup1a",
# "ocup4a",
"pn4",
# "pol1",
# "prot3",
# "q1",
# "q10a",
# "q10e",
# "q10new",
# "q11n",
# "q12",
# "q12bn",
# "q12c",
# "q14",
# "q2",
# "q3cn",
# "q5a",
# "q5b",
# "redist1",
# "redist2",
# "redist2a",
# "redist3",
# "ros4",
# "sd2new2",
# "sd3new2",
# "sd6new2",
# "smedia1",
# "smedia4",
# "smedia7",
# "soct2",
# "vb10",
# "vb2",
# "vb20",
# "vb50",
# "vb51",
# "vb52",
"vic1ext",
# "vic1exta",
# "w14a",
# "wf1",
"gendermc",
"wealthf",
"edrer",
"edad",
"ur",
"estratopri",
"pais",
"year",
"wave",
"pais_nam",
"pais_lab",
"weight1500",
"strata"
)
gmr <- gm[vars]
gmr <- gm[vars]
table(gmr$pais_lab)
class(gmr$pais_lab)
dta_cc = dstrata %>%
filter(as_factor(wave) %in% wave_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(vallabel = pais_lab) %>%
summarise_at(vars(ing4),
list(prop = ~survey_mean(between(., 5,
7),
na.rm = TRUE,
vartype = "ci") * 100)) %>%
mutate(proplabel = paste0(round(prop), "%")) %>%
rename(.,  lb = prop_low, ub = prop_upp)
dta_cc = dstrata %>%
filter(as_factor(wave) %in% wave_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(vallabel = as.character(as_factor(pais_lab))) %>%
summarise_at(vars(ing4),
list(prop = ~survey_mean(between(., 5,
7),
na.rm = TRUE,
vartype = "ci") * 100)) %>%
mutate(proplabel = paste0(round(prop), "%")) %>%
rename(.,  lb = prop_low, ub = prop_upp)
dstrata <- gmr %>%
as_survey(strata = strata, weights = weight1500)
dta_cc
dta_cc = dstrata %>%
filter(as_factor(wave) %in% wave_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(vallabel = as.character(as_factor(pais_lab))) %>%
summarise_at(vars(ing4),
list(prop = ~survey_mean(between(., 5,
7),
na.rm = TRUE,
vartype = "ci") * 100)) %>%
mutate(proplabel = paste0(round(prop), "%")) %>%
rename(.,  lb = prop_low, ub = prop_upp)
dta_cc
dta_cc = dstrata %>%
filter(as_factor(wave) %in% wave_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(vallabel = pais_lab) %>%
summarise_at(vars(ing4),
list(prop = ~survey_mean(between(., 5,
7),
na.rm = TRUE,
vartype = "ci") * 100)) %>%
mutate(proplabel = paste0(round(prop), "%")) %>%
rename(.,  lb = prop_low, ub = prop_upp)
dta_cc
saveRDS(dstrata, "C:/Users/plutowl/Desktop/gmrstrata.rds")
runApp('Documents/GitHub/lapop-shiny/app')
shiny::runApp('Documents/GitHub/lapop-shiny/app')
dstrata %>%
group_by_at(vars(one_of(unique(haven::as_factor(ing4))))) %>%
summarize(n = n())
dstrata <- readRDS("C:/Users/plutowl/Desktop/gmrstrata.rds")
dstrata <- gmr %>%
as_survey(strata = strata, weights = weight1500)
dstrata %>%
group_by_at(vars(one_of(unique(haven::as_factor(ing4))))) %>%
summarize(n = n())
dstrata %>%
group_by_(haven::as_factor(ing4)) %>%
summarize(n = n())
dstrata['variables']
dstrata$variables$
dstrata %>%
group_by_(haven::as_factor(variables$ing4)) %>%
summarize(n = n())
dstrata$variables$
dstrata %>%
group_by(haven::as_factor(variables$ing4)) %>%
summarize(n = n())
dta_ts = dstrata %>%
# filter(as_factor(wave) %in% input$wave) %>%
# filter(pais_nam %in% input$pais) %>%
group_by(as.character(as_factor(wave))) %>%
summarise_at(vars(ing4),
list(prop = ~survey_mean(between(., 5, 7),
na.rm = TRUE,
vartype = "ci") * 100)) %>%
mutate(proplabel = paste0(round(prop), "%")) %>%
rename(.,  wave = 1, lb = prop_low, ub = prop_upp)
dta_ts
dstrata$variables$
dstrata %>%
group_by(as.character(as_factor(wave)))
dta_mover_ur = dstrata %>%
filter(as_factor(wave) %in% wave_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(vallabel = haven::as_factor(zap_missing(ur))) %>%
summarise_at(vars(ing4),
list(prop = ~survey_mean(between(., 5,
7),
na.rm = TRUE,
vartype = "ci") * 100))
pais_sel = c("Jamaica", "Paraguay")
wave_sel = c("2021", "2023")
dta_mover_ur = dstrata %>%
filter(as_factor(wave) %in% wave_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(vallabel = haven::as_factor(zap_missing(ur))) %>%
summarise_at(vars(ing4),
list(prop = ~survey_mean(between(., 5,
7),
na.rm = TRUE,
vartype = "ci") * 100))
dta_mover_ur
dta_mover_ur = dstrata %>%
filter(as_factor(wave) %in% wave_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(vallabel = haven::as_factor(zap_missing(ur)))
dta_mover_ur
dstrata %>%
group_by(vars(one_of(unique(haven::as_factor(ing4))))) %>%
summarise_at(vars(ing4), list(n = n()))
dstrata %>%
# group_by(vars(one_of(unique(haven::as_factor(ing4))))) %>%
summarise_at(vars(ing4), list(n = count(.)))
dstrata %>%
# group_by(vars(one_of(unique(haven::as_factor(ing4))))) %>%
summarise(n = unweighted(n()))
dstrata %>%
# group_by(vars(one_of(unique(haven::as_factor(ing4))))) %>%
summarise(n = unweighted(n(ing4)))
dstrata %>%
group_by(vars(one_of(unique(haven::as_factor(ing4))))) %>%
summarise_at(vars(ing4),
list(n = unweighted(n())))
dstrata %>%
group_by(ing4) %>%
summarise_at(vars(ing4),
list(n = ~unweighted(n())))
dstrata %>%
group_by(ing4) %>%
summarise(n = unweighted(n()))
dstrata %>%
group_by(as_factor(ing4)) %>%
summarise(n = unweighted(n()))
dstrata %>%
group_by(as.character(as_factor(ing4))) %>%
summarise(n = unweighted(n()))
runApp('Documents/GitHub/lapop-shiny/app')
library(lazyeval)
runApp('Documents/GitHub/lapop-shiny/app')
dstrata %>%
group_by(across(ing4)) %>%
summarise(n = unweighted(n()))  %>%
group_by(ing4) %>%
drop_na() %>%
mutate(prop = prop.table(n) * 100,
proplabel = paste(round(prop), "%", sep = ""))  %>%
rename(cat = 1)
dstrata %>%
group_by(across(ing4)) %>%
summarise(n = unweighted(n()))  %>%
drop_na() %>%
mutate(prop = prop.table(n) * 100,
proplabel = paste(round(prop), "%", sep = ""))  %>%
rename(cat = 1)
dstrata %>%
group_by(across(as_factor(ing4))) %>%
summarise(n = unweighted(n()))  %>%
drop_na() %>%
mutate(prop = prop.table(n) * 100,
proplabel = paste(round(prop), "%", sep = ""))  %>%
rename(cat = 1)
dstrata %>%
group_by(across(as_factor(ing4))) %>%
summarise(n = unweighted(n()))  %>%
drop_na() %>%
mutate(prop = prop.table(n) * 100,
proplabel = paste(round(prop), "%", sep = ""))  %>%
rename(cat = 1)
dstrata %>%
))))))
dstrata %>%
group_by(across(ing4)) %>%
summarise(n = unweighted(n()))  %>%
drop_na() %>%
mutate(prop = prop.table(n) * 100,
proplabel = paste(round(prop), "%", sep = ""))  %>%
rename(cat = 1)
dstrata
dstrata %>%
group_by(across(ing4)) %>%
summarise(n = unweighted(n()))  %>%
drop_na() %>%
mutate(prop = prop.table(n) * 100,
proplabel = paste(round(prop), "%", sep = ""))  %>%
rename(cat = 1)
dstrata %>%
group_by(across(ing4)) %>%
summarise(n = unweighted(n()))  %>%
drop_na() %>%
mutate(prop = prop.table(n) * 100,
cat2 = as.character(1),
proplabel = paste(round(prop), "%", sep = ""))  %>%
rename(cat = 1)
dstrata %>%
group_by(across(ing4)) %>%
summarise(n = unweighted(n()))  %>%
drop_na() %>%
rename(cat = 1) %>%
mutate(prop = prop.table(n) * 100,
proplabel = paste(round(prop), "%", sep = ""))
dstrata %>%
group_by(across(ing4)) %>%
summarise(n = unweighted(n()))  %>%
drop_na() %>%
rename(cat = 1) %>%
mutate(prop = prop.table(n) * 100,
proplabel = paste(round(prop), "%", sep = ""),
cat2 = as.character(cat))
dstrata %>%
group_by(across(ing4)) %>%
summarise(n = unweighted(n()))  %>%
drop_na() %>%
rename(cat = 1) %>%
mutate(prop = prop.table(n) * 100,
proplabel = paste(round(prop), "%", sep = ""),
cat2 = as.character(haven::as_factor(cat)))
runApp('Documents/GitHub/lapop-shiny/app')
5+5
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
shiny::runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
dstrata <- readRDS("C:/Users/plutowl/Desktop/gmrstrata.rds")
min(dstrata$variables$ing4)
min(as.numeric(dstrata$variables$ing4))
min(as.numeric(dstrata$variables$ing4), na.rm= TRUE)
max(as.numeric(dstrata$variables$ing4), na.rm = TRUE)
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
dstrata[['variables']][['ing4']]
min(dstrata[['variables']][['ing4']])
min(dstrata[['variables']][['ing4']], na.rm=TRUE)
min(as.numeric(dstrata[['variables']][['ing4']]), na.rm=TRUE)
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
5+5
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
