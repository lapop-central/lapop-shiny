dta_cc
runApp('Documents/GitHub/lapop-shiny/app')
install.packages("bslip")
library(bslib)
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
unique(as_factor(gm2123$pais))
unique(sort(as_factor(gm2123$pais)))
class(gm2123$pais)
levels(as_factor(gm2123$pais))
sort(levels(as_factor(gm2123$pais)))
runApp('Documents/GitHub/lapop-shiny/app')
shiny::runApp('Documents/GitHub/lapop-shiny/app')
pais_lab <- read_csv("C:/Users/plutowl/Desktop/pais_lab.csv")
pais_lab <- read.csv("C:/Users/plutowl/Desktop/pais_lab.csv")
gm2123 <- read_dta("C:/Users/plutowl/Desktop/gm2123.dta")
pais_lab <- read.csv("C:/Users/plutowl/Desktop/pais_lab.csv")
gm2123 <- merge(gm2123, pais_lab, by = "pais", all.x = TRUE)
table(gm2123$pais)
table(gm2123$pais_lab)
gm2123 <- read_dta("C:/Users/plutowl/Desktop/gm2123.dta")
pais_lab <- read.csv("C:/Users/plutowl/Desktop/pais_lab.csv")
x <- merge(gm2123, pais_lab, by = "pais_num", all.x = TRUE)
x <- merge(gm2123, pais_lab, by.x = "pais", by.y = "pais_num", all.x = TRUE)
table(x$pais_lab)
table(x$pais)
table(x$pais_nam)
table(x$pais_lab, x$pais)
table(x$pais_lab)
table(x$pais)
summary(x$pais)
summary(x$pais_lab)
length(x$pais)
sum(is.na(x$pais))
sum(is.na(x$pais_lab))
y <- x[is.na(x$pais_lab), ]
View(y)
gm2123 <- read_dta("C:/Users/plutowl/Desktop/gm2123.dta")
pais_lab <- read.csv("C:/Users/plutowl/Desktop/pais_lab.csv")
x <- merge(gm2123, pais_lab, by.x = "pais", by.y = "pais_num", all.x = TRUE)
table(x$pais_lab)
table(x$pais)
x <- merge(gm2123, pais_lab, by.x = "pais", by.y = "pais_num")
table(x$pais_lab)
table(x$pais)
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
library(srvyr)
gm2123 <- read_dta("C:/Users/plutowl/Desktop/gm2123.dta")
pais_lab <- read.csv("C:/Users/plutowl/Desktop/pais_lab.csv")
gm2123 <- merge(gm2123, pais_lab, by.x = "pais", by.y = "pais_num")
library(shiny)
library(lapop)
library(haven)
library(dplyr)
gm2123 <- read_dta("C:/Users/plutowl/Desktop/gm2123.dta")
pais_lab <- read.csv("C:/Users/plutowl/Desktop/pais_lab.csv")
gm2123 <- merge(gm2123, pais_lab, by.x = "pais", by.y = "pais_num")
library(srvyr)
summary(gm2123$estratopri)
summary(gm2123$pais[is.na(gm2123$estratopri))
summary(gm2123$pais[is.na(gm2123$estratopri)])
table(gm2123$pais[is.na(gm2123$estratopri)])
summary(gm2123$weight1500)
dstrata <- gm2123 %>%
as_survey_design(weights = weight1500)
dstrata
survey_mean(gm2123$ing4)
survey_mean(gm2123$ing4)
dstrata %>%
survey_mean(gm2123$ing4)
dstrata %>%
summarise(survey_mean(ing4))
dstrata %>%
summarise(survey_mean(ing4, na.rm = TRUE))
dstrata %>%
group_by(pais) %>%
summarise(survey_mean(ing4, na.rm = TRUE))
dstrata %>%
group_by(pais) %>%
summarise(survey_mean(ing4, na.rm = TRUE, vartype = "ci"))
between(gm2123$ing4, 4, 7)
dstrata %>%
group_by(pais) %>%
summarise(survey_mean(between(ing4, 5, 7), na.rm = TRUE, vartype = "ci"))
between(gm2123$ing4, 4, 7)
dstrata %>%
group_by(pais) %>%
summarise(survey_mean(between(ing4, 5, 7), na.rm = TRUE, vartype = "ci"))
dta2
dta = gm2123 %>%
group_by(wave) %>%
summarise_at(vars(ing4),
list(prop = ~perc_pos(., min = 5, max = 7))) %>%
mutate(proplabel = paste0(round(prop), "%"),
lb = prop - 2,
ub = prop + 2)
perc_pos <- function(x, min, max){
return(mean(between((x), min, max), na.rm = TRUE) * 100)
}
dta = gm2123 %>%
group_by(wave) %>%
summarise_at(vars(ing4),
list(prop = ~perc_pos(., min = 5, max = 7))) %>%
mutate(proplabel = paste0(round(prop), "%"),
lb = prop - 2,
ub = prop + 2)
dta
x <- dstrata %>%
group_by(wave) %>%
summarise(survey_mean(between(ing4, 5, 7), na.rm = TRUE, vartype = "ci"))
dta
x
x <- dstrata %>%
group_by(wave) %>%
summarise(survey_mean(between(ing4, 5, 7), na.rm = TRUE, vartype = "ci") * 100)
x
dta
x <- dstrata %>%
group_by(wave) %>%
summarise(survey_mean(between(ing4, 5, 7), na.rm = TRUE, vartype = "ci") * 100) %>%
mutate(proplabel = paste0(round(prop), "%")) %>%
rename(c(coef = "prop"))
x <- dstrata %>%
group_by(wave) %>%
summarise(survey_mean(between(ing4, 5, 7), na.rm = TRUE, vartype = "ci") * 100) %>%
mutate(proplabel = paste0(round(prop), "%")) %>%
rename(coef = "prop")
x <- dstrata %>%
group_by(wave) %>%
summarise(survey_mean(between(ing4, 5, 7), na.rm = TRUE, vartype = "ci") * 100) %>%
mutate(proplabel = paste0(round(prop), "%"))
x <- dstrata %>%
group_by(wave) %>%
summarise(prop = survey_mean(between(ing4, 5, 7), na.rm = TRUE, vartype = "ci") * 100) %>%
mutate(proplabel = paste0(round(prop), "%"))
x
x <- dstrata %>%
group_by(wave) %>%
summarise(prop = survey_mean(between(ing4, 5, 7), na.rm = TRUE, vartype = "ci") * 100) %>%
mutate(proplabel = paste0(round(prop), "%"))
x
x <- dstrata %>%
group_by(wave) %>%
summarise(prop = survey_mean(between(ing4, 5, 7), na.rm = TRUE, vartype = "ci") * 100) %>%
mutate(proplabel = paste0(round(prop), "%"))
x <- dstrata %>%
group_by(wave) %>%
summarise(prop = survey_mean(between(ing4, 5, 7), na.rm = TRUE, vartype = "ci") * 100) %>%
mutate(proplabel = paste0(round(prop), "%")) %>%
rename(., prop_low = "lb")
x <- dstrata %>%
group_by(wave) %>%
summarise(prop = survey_mean(between(ing4, 5, 7), na.rm = TRUE, vartype = "ci") * 100) %>%
mutate(proplabel = paste0(round(prop), "%")) %>%
rename(.,  lb = prop_low)
x
x <- dstrata %>%
group_by(wave) %>%
summarise(prop = survey_mean(between(ing4, 5, 7), na.rm = TRUE, vartype = "ci") * 100) %>%
mutate(proplabel = paste0(round(prop), "%")) %>%
rename(.,  lb = prop_low, ub = prop_upp)
x
x <- dstrata %>%
group_by(wave) %>%
summarise_at(vars(ing4),
list(prop = survey_mean(between(., 5, 7), na.rm = TRUE, vartype = "ci") * 100)) %>%
mutate(proplabel = paste0(round(prop), "%")) %>%
rename(.,  lb = prop_low, ub = prop_upp)
x <- dstrata %>%
group_by(wave) %>%
summarise_at(vars(ing4),
list(prop = ~survey_mean(between(., 5, 7), na.rm = TRUE, vartype = "ci") * 100)) %>%
mutate(proplabel = paste0(round(prop), "%")) %>%
rename(.,  lb = prop_low, ub = prop_upp)
x
pais_select <- c("Jamaica", "Paraguay")
x <- dstrata %>%
filter(pais == pais_select) %>%
group_by(wave)
x <- dstrata %>%
filter(pais %in% pais_select) %>%
group_by(wave)
x <- gm2123 %>%
filter(pais %in% pais_select) %>%
group_by(wave)
x
x <- gm2123 %>%
filter(pais %in% pais_select) %>%
group_by(wave)
pais_select <- c("Jamaica", "Paraguay")
pais_select
"Jamaica" %in% pais_select
x <- gm2123 %>%
filter(pais %>% pais_select) %>%
group_by(wave)
pais_select <- c("Jamaica", "Paraguay")
x <- gm2123 %>%
filter(pais %>% pais_select) %>%
group_by(wave)
x <- gm2123 %>%
filter(pais %in% pais_select) %>%
group_by(wave)
x
x <- gm2123 %>%
filter(pais %in% pais_select) %>%
group_by(wave)
x
pais_select
table(gm2123$pais)
pais_lab
x <- gm2123 %>%
filter(pais_nam %in% pais_select) %>%
group_by(wave)
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
library(lapop)
?lapop_mover
df <- data.frame(varlabel = c(rep("Gender", 2), rep("Age", 6),
rep("Education", 4), rep("Wealth", 5)),
vallabel = c("Women", "Men", "18-25", "26-35", "36-45",
"46-55", "56-65", "66+", "  None", "Primary",
"Secondary", "Post-Sec.", "Low", "2",
"3", "4", "High"),
prop = c(20, 22, 21, 24, 22, 21, 17, 15, 20, 18, 21, 25, 21,
21, 21, 21, 22),
proplabel = c("20%", "22%", "21%", "24%", "22%", "21%",
"17%", "15%", "20%", "18%", "21%", "25%",
"21%", "21%", "21%", "21%", "22%"),
lb = c(19, 21, 20, 23, 21, 20, 15, 13, 16, 17, 20, 24, 20,
20, 20, 20, 21),
ub = c(21, 23, 22, 25, 23, 22, 19, 17, 24, 19, 22, 26, 22,
22, 22, 22, 23))
df
shiny::runApp('Documents/GitHub/lapop-shiny/app')
df <- data.frame(varlabel = c(rep("Gender", 2), rep("Age", 6),
rep("Education", 4), rep("Wealth", 5)),
vallabel = c("Women", "Men", "18-25", "26-35", "36-45",
"46-55", "56-65", "66+", "  None", "Primary",
"Secondary", "Post-Sec.", "Low", "2",
"3", "4", "High"),
prop = c(20, 22, 21, 24, 22, 21, 17, 15, 20, 18, 21, 25, 21,
21, 21, 21, 22),
proplabel = c("20%", "22%", "21%", "24%", "22%", "21%",
"17%", "15%", "20%", "18%", "21%", "25%",
"21%", "21%", "21%", "21%", "22%"),
lb = c(19, 21, 20, 23, 21, 20, 15, 13, 16, 17, 20, 24, 20,
20, 20, 20, 21),
ub = c(21, 23, 22, 25, 23, 22, 19, 17, 24, 19, 22, 26, 22,
22, 22, 22, 23))
dta_mover = dstrata %>%
filter(year %in% input$year) %>%
filter(pais_nam %in% input$pais) %>%
group_by(vallabel = as_factor(pais_lab)) %>%
summarise_at(vars(outcome()),
list(prop = ~survey_mean(between(., input$recode[1],
input$recode[2]),
na.rm = TRUE,
vartype = "ci") * 100)) %>%
mutate(proplabel = paste0(round(prop), "%")) %>%
rename(.,  lb = prop_low, ub = prop_upp)
dta_mover
gm2123 <- read_dta("C:/Users/plutowl/Desktop/gm2123.dta")
pais_lab <- read.csv("C:/Users/plutowl/Desktop/pais_lab.csv")
gm2123 <- merge(gm2123, pais_lab, by.x = "pais", by.y = "pais_num")
dstrata <- gm2123 %>%
as_survey_design(weights = weight1500)
dta_mover = gm2123 %>%
filter(year %in% input$year) %>%
filter(pais_nam %in% input$pais) %>%
group_by(vallabel = as_factor(pais_lab)) %>%
summarise_at(vars(outcome()),
list(prop = ~survey_mean(between(., input$recode[1],
input$recode[2]),
na.rm = TRUE,
vartype = "ci") * 100)) %>%
mutate(proplabel = paste0(round(prop), "%")) %>%
rename(.,  lb = prop_low, ub = prop_upp)
dta_mover = gm2123 %>%
filter(year %in% input$year) %>%
filter(pais_nam %in% input$pais) %>%
group_by(varlabel = as_factor(q1tc_r)) %>%
summarise(prop = mean(ing4))
dta_mover = gm2123 %>%
filter(year %in% year) %>%
filter(pais_nam %in% pais) %>%
group_by(varlabel = as_factor(q1tc_r)) %>%
summarise(prop = mean(ing4))
dta_mover
dta_mover = gm2123 %>%
filter(year %in% year) %>%
filter(pais_nam %in% pais) %>%
group_by(varlabel = as_factor(q1tc_r))
year_sel <- c("2021", "2023")
pais_sel <- c("Jamaica", "Paraguay")
dta_mover = gm2123 %>%
filter(year %in% year_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(varlabel = as_factor(q1tc_r))
dta_mover = gm2123 %>%
filter(year %in% year_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(varlabel = as_factor(q1tc_r)) %>%
summarise(prop = mean(ing4))
dta_mover
dta_mover = gm2123 %>%
filter(year %in% year_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(varlabel = as_factor(q1tc_r)) %>%
summarise(prop = mean(ing4, na.rm = TRUE))
dta_mover
dta_mover = gm2123 %>%
filter(year %in% year_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(varlabel = as_factor(q1tc_r)) %>%
summarise(prop = mean(ing4, na.rm = TRUE))
dta_mover
table(gm2123$q1tc_r)
dta_mover = gm2123 %>%
filter(pais_nam %in% pais_sel) %>%
summarise(prop = mean(ing4, na.rm = TRUE))
%>%
dta_mover = gm2123 %>%
filter(pais_nam %in% pais_sel) %>%
summarise(prop = mean(ing4, na.rm = TRUE))
dta_mover = gm2123 %>%
filter(year %in% year_sel) %>%
filter(pais_nam %in% pais_sel) %>%
summarise(prop = mean(ing4, na.rm = TRUE))
dta_mover = gm2123 %>%
filter(year %in% year_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(varlabel = as_factor(!is.na(q1tc_r))) %>%
summarise(prop = mean(ing4, na.rm = TRUE))
dta_mover
dta_mover = gm2123 %>%
filter(year %in% year_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(varlabel = as_factor(!is.na(q1tc_r))) %>%
summarise(prop = mean(ing4, na.rm = TRUE))
dta_mover
dta_mover = gm2123 %>%
filter(year %in% year_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(varlabel = as_factor(q1tc_r[!is.na(q1tc_r)])) %>%
summarise(prop = mean(ing4, na.rm = TRUE))
rlang::last_trace()
?as_factor
gm2123$genderm <- NA
gm2123$genderm <- ifelse(gm2123$q1tc_r == 1 | gm2123$q1tc_r == 2, gm2123$q1tc_r, gm2123$genderm)
table(gm2123$q1tb)
table(gm2123$q1tb, gm2123$year)
table(gm2123$q1tb[gm2123$year==2023])
table(gm2123$q1tb[gm2123$year==2023], gm2123$pais)
table(gm2123$q1tb[gm2123$year==2023], gm2123$pais[gm2123$year==2023])
table(gm2123$q1tb[gm2123$pais==5], gm2123$year)
table(gm2123$q1tb[gm2123$pais==5], gm2123$year[gm2123$pais==5])
table(gm2123$q1tc_r[gm2123$pais==5], gm2123$year[gm2123$pais==5])
gm2123$genderm <- NA
gm2123$genderm <- ifelse(gm2123$q1tc_r == 1 | gm2123$q1tc_r == 2, gm2123$q1tc_r, gm2123$genderm)
gm2123$genderm <- ifelse(is.na(gm2123$genderm) &  gm2123$q1tb < 3, gm2123$q1tb, gm2123$genderm)
dta_mover = gm2123 %>%
filter(year %in% year_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(varlabel = as_factor(genderm)) %>%
summarise(prop = mean(ing4, na.rm = TRUE))
dta_mover
dta_mover = gm2123 %>%
filter(year %in% year_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(varlabel = as_factor(genderm)) %>%
summarise_at(vars(ing4),
list(prop = ~survey_mean(between(., 5,
7),
na.rm = TRUE,
vartype = "ci") * 100))
dta_mover = gm2123 %>%
filter(year %in% year_sel) %>%
filter(pais_nam %in% pais_sel) %>%
group_by(varlabel = as_factor(genderm)) %>%
summarise_at(vars(ing4),
list(prop = ~mean(between(., 5,
7),
na.rm = TRUE,
vartype = "ci") * 100))
dta_mover
dta_mover
data(cars)
cols <- c("mpg","hp","wt")
mtcars %>%
group_by(across(all_of(cols))) %>%
summarize(x=mean(gear))
mtcars
shiny::runApp('Documents/GitHub/lapop-shiny/app')
library(shiny)
library(lapop)
library(haven)
library(srvyr)
library(dplyr)
# gm2123 <- read_dta("C:/Users/plutowl/Desktop/gm2123.dta")
gm <- read_dta("C:/Users/plutowl/Box/LAPOP Shared/2_Projects/2023 AB/Core_Regional/Data Processing/GM/Grand Merge 2004-2023 LAPOP AmericasBarometer (v1.0s).dta")
gm2 <- readstata13::read.dta13("C:/Users/plutowl/Box/LAPOP Shared/2_Projects/2023 AB/Core_Regional/Data Processing/GM/Grand Merge 2004-2023 LAPOP AmericasBarometer (v1.0s).dta")
gm2 <- readstata13::read.dta13("C:/Users/plutowl/Box/LAPOP Shared/2_Projects/2023 AB/Core_Regional/Data Processing/GM/Grand Merge 2004-2023 LAPOP AmericasBarometer (v1.0s).dta")
# gm2123 <- read_dta("C:/Users/plutowl/Desktop/gm2123.dta")
gm <- read_dta("C:/Users/plutowl/Box/LAPOP Shared/2_Projects/2023 AB/Core_Regional/Data Processing/GM/Grand Merge 2004-2023 LAPOP AmericasBarometer (v1.0s).dta")
library(haven)
# gm2123 <- read_dta("C:/Users/plutowl/Desktop/gm2123.dta")
gm <- read_dta("C:/Users/plutowl/Box/LAPOP Shared/2_Projects/2023 AB/Core_Regional/Data Processing/GM/Grand Merge 2004-2023 LAPOP AmericasBarometer (v1.0s).dta")
object.size(gm2)
# gm2123 <- read_dta("C:/Users/plutowl/Desktop/gm2123.dta")
gm <- read_dta("C:/Users/plutowl/Box/LAPOP Shared/2_Projects/2023 AB/Core_Regional/Data Processing/GM/Grand Merge 2004-2023 LAPOP AmericasBarometer (v1.0s).dta")
object.size(gm)
# gm2 <- readstata13::read.dta13("C:/Users/plutowl/Box/LAPOP Shared/2_Projects/2023 AB/Core_Regional/Data Processing/GM/Grand Merge 2004-2023 LAPOP AmericasBarometer (v1.0s).dta")
pais_lab <- read.csv("C:/Users/plutowl/Desktop/pais_lab.csv")
gm <- merge(gm, pais_lab, by.x = "pais", by.y = "pais_num")
gm$genderm <- NA
gm$genderm <- ifelse(gm$q1tc_r == 1 | gm$q1tc_r == 2, gm$q1tc_r, gm$genderm)
gm$genderm <- ifelse(is.na(gm$genderm) &  gm$q1tb < 3, gm$q1tb, gm$genderm)
gm$genderm2 <- factor(gm$genderm, levels = c(1, 2), labels = c("Men", "Women"))
gm$wealth[gm$wealth == 6] <- NA
gm$edre <- NA
gm$edrer <- ifelse(gm$edre < 3, 1,
ifelse(gm$edre <= 4, 2,
ifelse(gm$edre <= 6, 3, NA)))
gm$edrer <- factor(gm$edrer,
levels = c(1, 2, 3),
labels = c("None/Primary", "Secondary", "Superior"))
gm$wealth <- factor(gm$wealth,
levels = c(1, 2, 3, 4, 5),
labels = c("Low", "2", "3", "4", "High"))
dstrata <- gm %>%
as_survey_design(weights = weight1500)
library(lapop)
library(haven)
library(srvyr)
library(dplyr)
lapop_fonts_design()
dstrata <- gm %>%
as_survey_design(weights = weight1500)
?write_dta
write_dta(gm, "C:/Users/plutowl/Desktop/gmr.dta")
shiny::runApp('Documents/GitHub/lapop-shiny/app')
runApp('Documents/GitHub/lapop-shiny/app')
?read_dta()
# gm2121 <- read_dta("C:/Users/plutowl/Desktop/gm2123.dta")
gm <- read_dta("C:/Users/plutowl/Box/LAPOP Shared/2_Projects/2023 AB/Core_Regional/Data Processing/GM/Grand Merge 2004-2023 LAPOP AmericasBarometer (v1.0s).dta")
pais_lab <- read.csv("C:/Users/plutowl/Desktop/pais_lab.csv")
gm <- merge(gm, pais_lab, by.x = "pais", by.y = "pais_num")
gm$genderm <- NA
gm$genderm <- ifelse(gm$q1tc_r == 1 | gm$q1tc_r == 2, gm$q1tc_r, gm$genderm)
gm$genderm <- ifelse(is.na(gm$genderm) &  gm$q1tb < 3, gm$q1tb, gm$genderm)
gm$genderm2 <- factor(gm$genderm, levels = c(1, 2), labels = c("Men", "Women"))
gm$wealth[gm$wealth == 6] <- NA
gm$edre <- NA
gm$edrer <- ifelse(gm$edre < 3, 1,
ifelse(gm$edre <= 4, 2,
ifelse(gm$edre <= 6, 3, NA)))
gm$edrer <- factor(gm$edrer,
levels = c(1, 2, 3),
labels = c("None/Primary", "Secondary", "Superior"))
gm$wealth <- factor(gm$wealth,
levels = c(1, 2, 3, 4, 5),
labels = c("Low", "2", "3", "4", "High"))
write_dta(gm, "C:/Users/plutowl/Desktop/gmr.dta")
dstrata <- gm %>%
as_survey(strata = strata, weights = weight1500)
runApp('Documents/GitHub/lapop-shiny/app')
table(gm$aoj11)
# gm2121 <- read_dta("C:/Users/plutowl/Desktop/gm2123.dta")
# gm <- read_dta("C:/Users/plutowl/Box/LAPOP Shared/2_Projects/2023 AB/Core_Regional/Data Processing/GM/Grand Merge 2004-2023 LAPOP AmericasBarometer (v1.0s).dta")
gm <- read_dta("C:/Users/plutowl/Desktop/gm1.dta")
library(shiny)
library(lapop)
library(haven)
library(srvyr)
library(dplyr)
# gm2121 <- read_dta("C:/Users/plutowl/Desktop/gm2123.dta")
# gm <- read_dta("C:/Users/plutowl/Box/LAPOP Shared/2_Projects/2023 AB/Core_Regional/Data Processing/GM/Grand Merge 2004-2023 LAPOP AmericasBarometer (v1.0s).dta")
gm <- read_dta("C:/Users/plutowl/Desktop/gm1.dta")
# gm2 <- readstata13::read.dta13("C:/Users/plutowl/Box/LAPOP Shared/2_Projects/2023 AB/Core_Regional/Data Processing/GM/Grand Merge 2004-2023 LAPOP AmericasBarometer (v1.0s).dta")
pais_lab <- read.csv("C:/Users/plutowl/Desktop/pais_lab.csv")
gm <- merge(gm, pais_lab, by.x = "pais", by.y = "pais_num")
gm$genderm <- NA
gm$genderm <- ifelse(gm$q1tc_r == 1 | gm$q1tc_r == 2, gm$q1tc_r, gm$genderm)
gm$genderm <- ifelse(is.na(gm$genderm) &  gm$q1tb < 3, gm$q1tb, gm$genderm)
gm$genderm2 <- factor(gm$genderm, levels = c(1, 2), labels = c("Men", "Women"))
gm$wealth[gm$wealth == 6] <- NA
gm$edre <- NA
gm$edrer <- ifelse(gm$edre < 3, 1,
ifelse(gm$edre <= 4, 2,
ifelse(gm$edre <= 6, 3, NA)))
gm$edrer <- factor(gm$edrer,
levels = c(1, 2, 3),
labels = c("None/Primary", "Secondary", "Superior"))
gm$wealth <- factor(gm$wealth,
levels = c(1, 2, 3, 4, 5),
labels = c("Low", "2", "3", "4", "High"))
write_dta(gm, "C:/Users/plutowl/Desktop/gmr.dta")
dstrata <- gm %>%
as_survey(strata = strata, weights = weight1500)
runApp('Documents/GitHub/lapop-shiny/app')
table(gm$year)
table(gm$wave)
table(factor(gm$wave))
table(as_factor(gm$wave))
runApp('Documents/GitHub/lapop-shiny/app')
